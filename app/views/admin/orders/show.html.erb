<div class="container">
  <div class="row mt-4 mb-4">
    <h4 class="bg-light">注文履歴詳細</h4>
  </div>
  <div class="row">
    <div class="offset-md-1 col-md-auto">
      <table class="order_detail">
        <tr>
          <th>購入者</th>
          <td>
            <%= link_to admin_member_path(@order.member_id) do %>
              <%= @order.member.last_name %><%= @order.member.first_name %>
            <% end %>
          </td>
          <td></td>
        </tr>
        <tr>
          <th>注文日</th>
          <td><%= @order.created_at.strftime("%Y/%m/%d") %></td>
          <td></td>
        </tr>
        <tr>
          <th>配送先</th>
          <td>
            <div>〒 <%= @order.post_number %> <%= @order.address %></div>
            <div><%= @order.name %></div>
          </td>
          <td></td>
        </tr>
        <tr>
          <th>支払い方法</th>
          <td><%= @order.payment_methods_i18n %></td>
          <td></td>
        </tr>
        <tr>
          <th>注文ステータス</th>
          <%= form_with model:@order, url:admin_order_path(@order), local: true do |f| %>
          <td>
            <div class="">
              <%# ステータスのプルダウン%>
　　　　　　　<%= f.select :order_status, Order.order_statuses_i18n.invert %>
              <%= f.submit "更新", class: "btn btn-success ml-3" %>
            </div>
          </td>
          <td></td>
          <% end %>
        </tr>
      </table>
    </div>
  </div>
  <div class="row">
    <div class="col-8">
      <table class="table col-md-9 mx-auto">
        <thead class="table-light">
          <tr>
            <th>商品名</th>
            <th>単価(税込)</th>
            <th>数量</th>
            <th>小計</th>
            <th>製作ステータス</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% @order.item_orders.each do |item_orders| %>
          <tr>
            <td><%= item_orders.item.name %></td>
            <td><%= (item_orders.item.price*1.1).to_i %></td>
            <td><%= item_orders.count %></td>
            <%#単価×数量の合計値を表示する%>
            <td>
                <% subtotal = ((item_orders.item.price*item_orders.count)*1.1).to_i %>
                <%= subtotal %>
            </td>
            <%= form_with model:[@order,item_orders], url:admin_order_item_order_path(@order,item_orders),  local: true do |f| %>
            <td><%= f.select :making_status, ItemOrder.making_statuses_i18n.invert %> </td>
            <td><%= f.submit "更新", class: "btn btn-success ml-3" %></td>
            <td></td>
            <% end %>
          <% end %>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="col-4">
      <table>
        <tr>
          <td>商品合計</td>
          <td><%= @total_payment %></td>
        </tr>
        <tr>
          <td>送料</td>
          <td>800</td>
        </tr>
        <tr>
          <td>請求額合計</td>
          <td><%= @total_payment + 800 %></td>
        </tr>
      </table>
    </div>
  </div>
</div>